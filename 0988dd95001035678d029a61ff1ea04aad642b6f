{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "74eddb98_7834db64",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-04-13T05:58:42Z",
      "side": 1,
      "message": "This is quite broad, but I guess not all files are labelled. This doesn\u0027t run with any extra privileges anyways I guess, given that it\u0027s user nobody group nobody",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da086630_bd86ea58",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-04-13T11:31:20Z",
      "side": 1,
      "message": "Yes, we need to label them ourselves if we want it to be any more fine-grained than this, and we would also need to make sure nothing else is adversely impacted. I don\u0027t know if we should bother -- what do you think? We are already able to bypass this for `write` commands when we disable USB data.\n\nAlso: it doesn\u0027t run as `nobody`. I should probably clarify the init files, because the onrestart actions aren\u0027t subject to the user and group, only the service command itself is. So `linkerconfig --help` is running as nobody. The `exec`, unless otherwise specified, I believe runs as root.\n\n\u003e Currently defaults to root. (??? probably should default to nobody)\n\n^ From https://android.googlesource.com/platform/system/core/+/refs/heads/master/init/README.md\n\n(That is describing the `user` value, but I think it\u0027s also the default for `exec` and friends.)",
      "parentUuid": "74eddb98_7834db64",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "68cf90ff_acd24b1a",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-04-13T12:36:49Z",
      "side": 1,
      "message": "Labelling it more fine-grained is going to be a PITA.\n\nWhich files exactly is this needed for?\n\n\u003e `root`\n\nI don\u0027t like that.",
      "parentUuid": "da086630_bd86ea58",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63597ddd_017bf86d",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-04-13T12:59:37Z",
      "side": 1,
      "message": "I think we can run it as `system:system` instead already, or maybe even `nobody:system`, since everything we need (except `a600000.ssusb/mode`, which we could adjust) has proper access for the `system` group, established `on post-fs` in those usb gadget .rc files we\u0027ve been editing. I\u0027ll see.\n\nAs for what we need, it\u0027s device-dependent.\n\nFor qcom, we need:\n- /sys/devices/platform/soc/a600000.ssusb/mode (write)\n\nFor gs101, we need:\n- /sys/devices/platform/11110000.usb/dwc3_exynos_otg_id (write)\n- /sys/devices/platform/11110000.usb/dwc3_exynos_otg_b_sess (write)\n\nFor gs201, we need:\n- /sys/devices/platform/11210000.usb/dwc3_exynos_otg_id (write)\n- /sys/devices/platform/11210000.usb/dwc3_exynos_otg_b_sess (write)\n\nFor all, we need:\n- /sys/class/typec/port0/data_role (read)\n- /sys/class/typec/port0-partner (just check existence)",
      "parentUuid": "68cf90ff_acd24b1a",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29ea1ca6_23ed032f",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-04-13T13:33:36Z",
      "side": 1,
      "message": "It\u0027s working on gs201 as `nobody:system`, and also for bramble (qcom) if I add the same `chown` lines for `/mode` that it uses for usb_data_enabled, id, and b_sess.\n\n(I noticed qcom also sets `/id` and `/b_sess` which made me wonder if we could use those, but they\u0027re not even present on bramble, with OTG connected or otherwise, so no.)\n\nAlso, forgot to include `/usb_data_enabled` in the paths above.",
      "parentUuid": "63597ddd_017bf86d",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2788f9fd_1299a569",
        "filename": "common/vendor/init_enable_usb_data.te",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-04-13T18:18:53Z",
      "side": 1,
      "message": "With this now running as `nobody:system`, I have no concerns. Do you?",
      "parentUuid": "29ea1ca6_23ed032f",
      "revId": "0988dd95001035678d029a61ff1ea04aad642b6f",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}